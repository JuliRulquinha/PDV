
<div class="pos-container" style="padding:32px;">
  <ng-container *ngIf="products.length">
    <ng-container *ngIf="products[products.length-1] as lastProduct">
      <!-- Nome do produto e barra de pesquisa na mesma linha -->
      <div style="display:flex;align-items:center;justify-content:space-between;width:100%;margin-bottom:8px;gap:16px;">
        <span style="font-weight:bold;font-size:1.5em;text-align:left;">{{ lastProduct.nome }}</span>
        <div style="display:flex;align-items:center;gap:0;">
          <input type="text" class="pos-input" placeholder="" style="width:220px;border:none;box-shadow:none;outline:none;" />
          <span style="margin-left:-32px;cursor:pointer;"><i class="material-icons" style="font-family: 'Material Icons'; font-style: normal; font-weight: normal; font-size: 24px; line-height: 1; letter-spacing: normal; text-transform: none; display: inline-block; white-space: nowrap; direction: ltr; -webkit-font-feature-settings: 'liga'; -webkit-font-smoothing: antialiased;">search</i></span>
        </div>
      </div>
      <!-- Imagem, infos e lista de produtos lado a lado, com código alinhado ao cabeçalho da lista -->
  <div style="display:flex;align-items:flex-start;gap:8px;width:100%;margin-bottom:8px;">
  <div style="display:flex;flex-direction:column;gap:0;min-width:480px;margin-right:12px;">
          <div class="pos-info-card" style="font-size:1.0875em;padding:13.92px 17.4px;min-width:530px;max-width:530px;margin-bottom:14px;"><strong>CÓDIGO:</strong> {{ lastProduct.id }}</div>
          <div style="display:flex;flex-direction:row;gap:22px;">
            <div style="width:280px;height:280px;display:flex;align-items:center;justify-content:center;background:#f9f9f9;border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.12);margin-bottom:8px;">
              <img [src]="lastProduct.imageUrl" alt="Foto do produto" style="max-width:90%;max-height:90%;object-fit:contain;" />
            </div>
            <div style="display:flex;flex-direction:column;gap:14px;min-width:209px;">
              <div class="pos-info-card" style="font-size:1.0875em;padding:13.92px 17.4px;min-width:191px;"><strong>VALOR DE CUSTO:</strong> R$ {{ lastProduct.valorCusto !== undefined && lastProduct.valorCusto !== null ? lastProduct.valorCusto.toFixed(2) : '-' }}</div>
              <div class="pos-info-card" style="font-size:1.0875em;padding:13.92px 17.4px;min-width:191px;"><strong>VALOR DE VENDA:</strong> R$ {{ lastProduct.valorVenda !== undefined && lastProduct.valorVenda !== null ? lastProduct.valorVenda.toFixed(2) : '-' }}</div>
              <div class="pos-info-card" style="font-size:1.0875em;padding:13.92px 17.4px;min-width:191px;"><strong>MARCA:</strong> {{ lastProduct.marca || '-' }}</div>
              <div class="pos-info-card" style="font-size:1.0875em;padding:13.92px 17.4px;min-width:191px;"><strong>MODELO:</strong> {{ lastProduct.modelo || '-' }}</div>
              <div class="pos-info-card" style="font-size:1.0875em;padding:13.92px 17.4px;min-width:191px;"><strong>QTD:</strong> {{ lastProduct.quantidade }}</div>
            </div>
          </div>
        </div>
        <!-- Lista de produtos à direita -->
        <div class="pos-products-card" style="flex:2;min-height:600px;max-height:600px;background:#fff;padding:16px;min-width:340px;display:flex;flex-direction:column;position:relative;">
          <div *ngIf="products.length" style="display:flex;flex-direction:column;height:100%;">
            <!-- Cabeçalho da lista fixo -->
            <div style="display:flex;align-items:center;margin-bottom:8px;padding-bottom:8px;font-weight:bold;color:#1976d2;border-bottom:1px solid #e0e0e0;position:sticky;top:0;z-index:2;background:#fff;">
              <span style="width:80px;text-align:center;display:inline-block;">ID</span>
              <span style="width:200px;text-align:center;display:inline-block;position:relative;left:-12px;">PRODUTO</span>
              <span style="width:120px;text-align:center;display:inline-block;position:relative;left:-12px;">PREÇO</span>
              <span style="width:100px;text-align:left;display:inline-block;position:relative;left:48px;">QTD</span>
              <span style="width:140px;text-align:center;display:inline-block;">TOTAL</span>
            </div>
            <!-- Área scrollável dos itens -->
            <div style="overflow-y:auto;max-height:340px;display:flex;flex-direction:column;">
              <ng-container *ngFor="let p of products; trackBy: trackById">
                <div style="display:flex;align-items:center;margin-bottom:18px;padding-bottom:8px;">
                  <span style="width:80px;font-weight:bold;text-align:center;display:inline-block;">{{ p.id }}</span>
                  <span style="width:200px;text-align:center;display:inline-block;">{{ p.nome }}</span>
                  <span style="width:120px;text-align:center;display:inline-block;">R$ {{ p.valorVenda != null ? p.valorVenda.toFixed(2) : '-' }}</span>
                  <span style="width:32px;text-align:center;font-weight:bold;display:inline-block;">x</span>
                  <span style="width:100px;text-align:left;display:inline-block;position:relative;left:48px;">{{ p.quantidade }}</span>
                  <span style="width:140px;text-align:center;display:inline-block;">R$ {{ p.valorVenda != null ? (p.valorVenda * p.quantidade).toFixed(2) : '-' }}</span>
                </div>
              </ng-container>
            </div>
            <!-- Total, valor recebido, troco e total de itens fixos na base do componente -->
            <div style="display:flex;flex-direction:row;align-items:flex-end;justify-content:space-between;margin-top:auto;gap:32px;background:#fff;padding:24px 32px 24px 32px;position:absolute;left:0;right:0;bottom:0;">
              <div style="font-size:1.2em;font-weight:bold;">Itens: {{ products.length }}</div>
              <div style="display:flex;flex-direction:column;align-items:flex-end;">
                <div style="font-size:1.2em;font-weight:bold;">Total: R$ {{ total.toFixed(2) }}</div>
                <div style="margin-top:8px;">Valor recebido: <input type="number" min="0" class="pos-input" [(ngModel)]="valorRecebido" placeholder="Valor recebido" style="width:120px;" /></div>
                  <div style="margin-top:8px;font-size:1.25em;">Troco: <span style="font-weight:bold;color:#2e7d32;">R$ {{ (valorRecebido - total) > 0 ? (valorRecebido - total).toFixed(2) : '0.00' }}</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Teclas de atalho -->
      <div style="width:100%;margin-bottom:16px;text-align:center;">
        <span style="margin-right:16px;">F2 - Buscar</span>
        <span style="margin-right:16px;">F3 - Adicionar</span>
        <span>F4 - Finalizar</span>
      </div>
    </ng-container>
  </ng-container>
  <div class="pos-main" style="display:flex;gap:32px;">
    <!-- Painel lateral -->
    <div class="pos-side-panel">
      <div class="pos-keypad">
        <input type="text" class="pos-input" placeholder="Código do produto" [(ngModel)]="codigoProduto" style="width:180px;" />
        <input type="number" min="1" class="pos-input" placeholder="Qtd" [(ngModel)]="quantidadeProduto" style="margin-top:8px;width:80px;" />
        <button class="add-btn" (click)="adicionarProduto()">Adicionar Produto</button>
      </div>
      <div class="pos-actions">
        <button (click)="finalizarVenda()">Finalizar Venda</button>
        <button (click)="cancelar()">Cancelar</button>
      </div>
    </div>
  </div>
