
<div class="pos-container">
  <h2 class="pos-title">Caixa Supermercado</h2>
  <ng-container *ngIf="products.length">
    <ng-container *ngIf="products[products.length-1] as lastProduct">
      <div *ngIf="lastProduct.imageUrl" class="pos-product-preview" style="display:flex;align-items:center;justify-content:center;margin-bottom:16px;gap:32px;">
        <div>
          <img [src]="lastProduct.imageUrl" alt="Foto do produto" style="max-width:220px;max-height:220px;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.12);margin-bottom:8px;" />
          <div style="font-weight:bold;font-size:1.2em;margin-top:8px;">{{ lastProduct.nome }}</div>
        </div>
        <div class="pos-info-cards-grid">
          <div class="pos-info-card">
            <div class="pos-info-header">Valor de Custo</div>
            <div class="pos-info-value">R$ {{ lastProduct.valorCusto !== undefined && lastProduct.valorCusto !== null ? lastProduct.valorCusto.toFixed(2) : '-' }}</div>
          </div>
          <div class="pos-info-card">
            <div class="pos-info-header">Valor de Venda</div>
            <div class="pos-info-value">R$ {{ lastProduct.valorVenda !== undefined && lastProduct.valorVenda !== null ? lastProduct.valorVenda.toFixed(2) : '-' }}</div>
          </div>
          <div class="pos-info-card">
            <div class="pos-info-header">Marca</div>
            <div class="pos-info-value">{{ lastProduct.marca || '-' }}</div>
          </div>
          <div class="pos-info-card">
            <div class="pos-info-header">Modelo</div>
            <div class="pos-info-value">{{ lastProduct.modelo || '-' }}</div>
          </div>
        </div>
      </div>
    </ng-container>
  </ng-container>
  <div class="pos-main">
    <div style="display:flex;flex-direction:column;align-items:flex-start;">
      <div class="pos-products-card">
        <table>
          <thead>
            <tr>
              <th>Código</th>
              <th>Produto</th>
              <th>Preço</th>
              <th>Qtd</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let p of products; trackBy: trackById">
              <td>{{ p.id }}</td>
              <td>{{ p.nome.length > 10 ? (p.nome | slice:0:10) + '...' : p.nome }}</td>
              <td>R$ {{ p.valorVenda != null ? p.valorVenda.toFixed(2) : '-' }}</td>
              <td>{{ p.quantidade }}</td>
              <td>R$ {{ p.valorVenda != null ? (p.valorVenda * p.quantidade).toFixed(2) : '-' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="pos-payment-horizontal-panel">
        <div style="display:flex;align-items:flex-start;justify-content:flex-start;width:100%;padding:18px 24px;background:#f5f5f5;border-radius:16px;box-shadow:0 2px 12px rgba(0,0,0,0.08);margin:8px 0 0 0;gap:32px;">
          <div style="display:flex;flex-direction:column;gap:8px;min-width:220px;max-width:320px;flex:1;">
            <label for="tipoPagamento" style="font-weight:bold;">Tipo de pagamento:</label>
            <select id="tipoPagamento" class="pos-input" [(ngModel)]="tipoPagamento" style="margin-bottom:8px;width:180px;">
              <option value="dinheiro">Dinheiro</option>
              <option value="cartao">Cartão</option>
              <option value="pix">Pix</option>
            </select>
            <label for="valorRecebido" style="font-weight:bold;">Valor recebido:</label>
            <input id="valorRecebido" type="number" min="0" class="pos-input" [(ngModel)]="valorRecebido" placeholder="Valor recebido" style="margin-bottom:8px;width:180px;" />
          </div>
          <div style="display:flex;flex-direction:column;align-items:center;gap:8px;min-width:180px;max-width:300px;flex:1;">
            <div class="pos-troco-panel" style="margin-bottom:12px;">
              <div style="display:flex;flex-direction:row;align-items:center;gap:12px;width:100%;max-width:340px;margin-top:24px;">
                <span style="font-weight:bold;font-size:1.3em;">Troco:</span>
                <span style="font-size:1.7em;color:#2e7d32;white-space:nowrap;">R$ {{ (valorRecebido - total) > 0 ? (valorRecebido - total).toFixed(2) : '0.00' }}</span>
              </div>
            </div>
            <div class="pos-summary" style="font-size:1.7em;white-space:nowrap;">
              <div style="display:flex;flex-direction:row;align-items:center;gap:16px;">
                <label style="vertical-align:middle;">Total:</label>
                <span class="pos-total" style="font-size:1.3em;vertical-align:middle;">R$ {{ total.toFixed(2) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="pos-side-panel">
      <div class="pos-keypad">
        <input type="text" class="pos-input" placeholder="Código do produto" [(ngModel)]="codigoProduto" />
        <div class="keypad-grid">
          <button *ngFor="let n of [1,2,3,4,5,6,7,8,9,0]" (click)="codigoProduto += n">{{n}}</button>
          <button (click)="codigoProduto = codigoProduto.slice(0, -1)">⌫</button>
        </div>
        <input type="number" min="1" class="pos-input" placeholder="Qtd" [(ngModel)]="quantidadeProduto" style="margin-top:8px;width:80px;" />
        <button class="add-btn" (click)="adicionarProduto()">Adicionar Produto</button>
      </div>
      <div class="pos-actions">
        <button (click)="finalizarVenda()">Finalizar Venda</button>
        <button (click)="cancelar()">Cancelar</button>
      </div>
    </div>
  </div>
